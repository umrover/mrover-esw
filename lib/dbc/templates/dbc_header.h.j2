/* {{dbc_name}}.h */
/* THIS FILE IS AUTO-GENERATED BY "can_header_gen.py" */
{# Include C libraries #}
{%- for lib in libs %}
#include <{{ lib }}>
{%- endfor %}

#pragma once
{#- Struct definitions #}
{% for msg in message_dict %}
class {{ message_dict[msg].name }} {
    public:
    // Signals
    {%- set signals = message_dict[msg].signal_dict %}
    {%- for signal in signals %}
    {{signals[signal].data_type}} {{signal}};
    {%- endfor %}

    // Byte array representation of message
    uint8_t msg_arr[{{ message_dict[msg].byte_length }}];

    // Constructors serve as our encode/decode functions
    
    // Decode into message class format
    {{ message_dict[msg].name }}(uint8_t * byte_arr) {
        uint32_t i = 0;
    {%- set ns = namespace(boolIter = 0) %}
    {%- for signal in signals %}
    {%- if signals[signal].bit_length == 1 %}
    {%- if ns.boolIter == 8 %}
    {%- set ns.boolIter = 0%}
        ++i;
    {%- endif %}
        {{ signal }} = (byte_arr[i] >> {{ ns.boolIter }}) & 0b1;
    {%- set ns.boolIter = ns.boolIter + 1 %}
    {%- else %}

        uint{{ signals[signal].bit_length }}_t temp_{{ signal }} = 0;
        for (uint8_t j = 0; j < {{ signals[signal].byte_length}}; ++i, ++j) {
            temp_{{ signal }} |= byte_arr[i] << 8*j;
        }
        {{ signal }} = std::bit_cast<{{ signals[signal].data_type }}>(temp_{{ signal }});
    {%- endif %}
    {%- endfor %}
    }

    // Encode into byte array format
    {{ message_dict[msg].name }}(
    {%- for signal in signals %}
        {{signals[signal].data_type}} {{signal}}
        {%- if not loop.last %},
        {%- endif %}
    {%- endfor %}
    ) : 
    {%- for signal in signals %}
        {{signal}}({{signal}})
        {%- if not loop.last %},
        {%- endif %}
    {%- endfor %}
     {
    {%- set ns = namespace(boolIter = 0) %}
        uint32_t i = 0;
    {%- for signal in signals %}
    {%- if signals[signal].bit_length == 1 %}
    {%- if ns.boolIter == 8 %}
    {%- set ns.boolIter = 0%}
        ++i;
    {%- endif %}
        msg_arr[i] = {{ signal }} ? msg_arr[i] | (1 << {{ ns.boolIter }}) : msg_arr[i] & ~(1 << {{ ns.boolIter }});
    {%- set ns.boolIter = ns.boolIter + 1 %}
    {%- else %}
        for (uint8_t j = 0; j < {{ signals[signal].byte_length }}; ++i, ++j) {
            msg_arr[i] = (std::bit_cast<uint{{ signals[signal].bit_length }}_t>({{ signal }}) >> 8*j) & 0xFF;
        }
    {%- endif %}
    {%- endfor %}
    }
};
{% endfor %}