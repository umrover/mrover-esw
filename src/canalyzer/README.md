# CANalyzer

***DEVELOPMENT FOR THIS PROJECT TAKES PLACE ON THE `canalyzer` BRANCH***

CANalyzer will be a custom CAN bus traffic logging device. The end-goal is to have a fully configurable
device that can be used to monitor and log CAN bus traffic to both a database and log files for easy viewing and replayability. 

## Materials

- [Raspberry Pi 5](https://www.raspberrypi.com/products/raspberry-pi-5/)
- [Waveshare CAN FD pihat](https://www.waveshare.com/2-ch-can-fd-hat.htm)

## Project Goals

- **Real-time Monitoring:** Use SocketCAN to read CAN traffic in real-time, decode received CAN messages using provided .dbc files, and upload the desired signals and corresponding values to an InfluxDB database.
- **Logging:** Enable CAN traffic logging to .asc or .blf files for replayability.
- **Easy startup:** Use Docker and possibly Bash scripting to startup the logger, database, and any other desired features when the device is turned on.
- **Web GUI for displaying InfluxDB CAN data:** Use Grafana or a custom web GUI to query InfluxDB and display data from desired timeframes on custom dashboards.

## Helpful Resources

- [SocketCAN](https://docs.kernel.org/networking/can.html): Socket CAN provides a CAN interface for Linux devices. For the CANalyzer project we will be using SocketCAN to interface with CAN using a Raspberry Pi 5 and a [Waveshare CAN FD pihat](https://www.waveshare.com/2-ch-can-fd-hat.htm), the pihat product page also has a getting started tutorial.
- [Docker](https://docs.docker.com/get-started/): Docker allows for the creation of containers that can be isolated from other containers. This makes it easy to run instances of an image such as InfluxDB while being able to manage volume mounts, network configuration, and separate its dependencies from another container such as Grafana.
- [Docker Compose](https://docs.docker.com/compose/): Docker compose can be used to provide a yaml configuration of multiple Docker containers. This makes it much easier to create and manage containers over time.
- [InfluxDB](https://docs.influxdata.com/influxdb/v1/introduction/install/docker/): InfluxDB is a time-series database that is efficient, simple to interface with, and supports an official Docker image.
- [Grafana](https://grafana.com/docs/grafana/latest/setup-grafana/installation/docker/): Grafana is a web GUI that makes it easy to query datasources and display desired time series data on custom JSON dashboards. Grafana has an official Docker image and officially supports InfluxDB, making it easy to setup and interface with InfluxDB databases using Docker.

## Project Notes

- Mount influx and grafana volumes to /influxdb_data and /grafana_data on pi.
- Have an influx database for every dbc.
- Write message names as defined in dbcs to database.
- When the canalyzer container starts, parse yaml file and find all desired CAN IDs to be logged, then when a desired CAN ID is received use functions generated by dbc-parsing project to decode the message and upload the signal name and value.
- Total 3 containers: logger container, influxdb, and grafana
- To start the logger, run a bash script to ensure directory and database permissions are correct, then bring up docker containers using docker compose file.